<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eventos de Flesh and Blood Colombia :  The Hunted</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-image: url('https://dhhim4ltzu1pj.cloudfront.net/media/images/art_hnt_keyart.original.jpg');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            color: #ffffff;
        }

        header {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            background-color: rgba(18, 8, 35, 0.8);
        }
        header img {
            height: 80px;
            margin-right: 20px;
        }

        header h1 {
            font-size: 24px;
            margin: 0;
        }

        main {

            margin-left:auto;
            margin-right:auto;
            margin-top:10px;
            margin-bottom:10px;
            max-width: 800px;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 5px;
            text-align: center;
            margin-bottom: 20px;
        }
        .calendar .month .title {
            text-align: center;
            margin-bottom: 20px;
        }
        .calendar .month .grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            text-align: center;
            margin-bottom: 20px;
        }
        .calendar div {
            padding: 10px;
            background-color: rgba(68, 68, 68, 0.6);
            border: 1px solid #333;
        }

        .calendar .header {
            background-color: rgba(51, 51, 51, 0.6);
            font-weight: bold;
        }

        .calendar .event {
            background-color: rgba(158, 148, 175, 0.6);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: rgba(51, 51, 51, 0.6);
        }

        td {
            background-color: rgba(85, 85, 85, 0.6);
        }

        tr:nth-child(even) td {
            background-color: rgba(68, 68, 68, 0.6);
        }
    </style>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const parseUTCDate = (dateString) => {
          const [year, month, day] = dateString.split('-').map(Number);
          return new Date(Date.UTC(year, month - 1, day)); // Month is zero-indexed
        };
        
            fetch('Eventos_de_la_Comunidad_Flesh_and_Blood_Q1_2025__D_as_en_Espa_ol_.csv')
                .then(response => response.text())
                .then(data => {
                    const rows = data.split('\n').slice(1); // Skip header row
                    const tableBody = document.querySelector('tbody');
                    const events = [];
                  const eventsByMonth = {};          
        rows.map(row => row.split(','))
        .filter(columns => columns.length === 6).sort((a, b) => {
                        const dateA = parseUTCDate(a[0]);
                        const dateB = parseUTCDate(b[0]);
                        return dateA - dateB;
                    }).forEach(columns => {
        events.push(columns[0]); // Push date
                      const eventDate  = parseUTCDate(columns[0]);
                      const eventMonth = new Intl.DateTimeFormat('es-ES', { month: 'long', timeZone : 'UTC' }).format(eventDate);
                            const tr = document.createElement('tr');
                            columns.forEach(col => {
                                const td = document.createElement('td');
                                td.textContent = col;
                                tr.appendChild(td);
                            });
                      if(!eventsByMonth[eventMonth]){
                        eventsByMonth[eventMonth] = []
                      }
                      eventsByMonth[eventMonth].push(tr)
                      
        });

                    // Generate calendar
                    const calendar = document.querySelector('.calendar');
                  const firstDay = new Date(Date.UTC(2025,0,01));
                  const lastDay = new Date(Date.UTC(2025,2,31));
                  const daysOfWeek = [ 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'];

                  function createMonth(calendar, currentDate) {
                  const month = document.createElement('div');
                    month.classList.add('month');
                  const label =  document.createElement('div');
                    label.textContent = new Intl.DateTimeFormat('es-ES', { month: 'long', timeZone : 'UTC' }).format(currentDate);
                    month.appendChild(label);
                    label.classList.add('label');
                    const grid =  document.createElement('div');
                    grid.classList.add('grid');
                    month.appendChild(grid);
                  // Add headers
                  daysOfWeek.forEach(day => {
                    const div = document.createElement('div');
                    div.textContent = day;
                    div.classList.add('header');
                    grid.appendChild(div);
                  });
                    calendar.appendChild(month);
                    
                    let dayOfWeek = currentDate.getUTCDay() - 1;
                    if( dayOfWeek < 0 ){
                      dayOfWeek = 7
                    }
                    for (let i = 0; i < dayOfWeek; i++) {
                      const div = document.createElement('div');
                      div.classList.add('padding');
                      grid.appendChild(div);
                    }
                    const table = document.createElement('table');
                    const thead = document.createElement('thead');
                    const tbody = document.createElement('tbody');

                    // Add table headers
                    thead.innerHTML = `
                    <tr>
                        <th>Fecha</th>
                        <th>Día</th>
                        <th>Evento</th>
                        <th>Hora</th>
                        <th>Ubicación</th>
                        <th>Reminder</th>
                    </tr>
                 `;

                
                    table.appendChild(thead);
                    table.appendChild(tbody);
                    month.appendChild(table)
                    return { 'grid': grid, 'table' : table };
                  }
                    // Fill calendar
                  let currentDate = firstDay;
                  let month = createMonth(calendar, currentDate);

                  let lastMonth = new Intl.DateTimeFormat('es-ES', { month: 'long', timeZone : 'UTC' }).format(currentDate);
                  eventsByMonth[lastMonth].forEach(tr => month.table.appendChild(tr));
                    while (currentDate <= lastDay) {
                      const div = document.createElement('div');
                      const dateStr = currentDate.toISOString().split('T')[0];
                      const curMonth = new Intl.DateTimeFormat('es-ES', { month: 'long', timeZone : 'UTC' }).format(currentDate);
                      if (curMonth !== lastMonth){
                        month = createMonth(calendar, currentDate);
                        lastMonth = curMonth
                        eventsByMonth[lastMonth].forEach(tr => month.table.appendChild(tr));
                      }
                        div.textContent = currentDate.getUTCDate();
                        if (events.includes(dateStr)) {
                            div.classList.add('event');
                        }

                        month.grid.appendChild(div);
                      currentDate.setUTCDate(currentDate.getUTCDate() + 1);
                    }
                })
                .catch(error => console.error('Error loading CSV:', error));
        });
    </script>
</head>
<body>
    <header>
      <img src="FABLogo.jpg" alt="FABCO Logo">
      <img src="https://dhhim4ltzu1pj.cloudfront.net/media/images/the_hunted_logo.original.png" alt="The Hunted Logo">
        <h1>Flesh and Blood Colombia</h1>
        
    </header>
    <main>
        <h2>Calendario de Eventos: Version 20250102 </h2>
        <div class="calendar">
            <!-- Calendar will be populated dynamically -->
        </div>
    </main>
</body>
</html>
